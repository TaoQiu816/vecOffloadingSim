# 配置修复总结

## 问题

### 1. 训练失败（Episode 1-20）
- ❌ Task Success Rate = 0%
- ❌ 策略收敛到100% RSU
- ❌ Subtask SR仅10%

### 2. 环境断言失败
```
AssertionError: ❌ 单位缩放错误：典型传输时间为 6.94ms < 10ms！
```

---

## 修复方案

### 第一轮修复（解决Task SR = 0%）

| 参数 | 原值 | 第一次修复 | 理由 |
|------|------|-----------|------|
| MIN_COMP | 1.0e8 | 2.0e7 (↓80%) | 确保本地可完成 |
| MAX_COMP | 1.0e9 | 2.0e8 (↓80%) | 最坏2.4s可完成 |
| MIN_DATA | 4.0e5 | 2.0e5 (↓50%) | 减少传输时间 |
| MAX_DATA | 2.0e6 | 1.0e6 (↓50%) | 减少传输时间 |
| DEADLINE_MIN | 1.0 | 2.0 (↑100%) | 放宽deadline |
| DEADLINE_MAX | 1.5 | 3.0 (↑100%) | 放宽deadline |

**结果**: 计算量问题解决，但数据量太小触发断言

---

### 第二轮修复（解决断言错误）

| 参数 | 第一次修复 | 最终值 | 理由 |
|------|-----------|--------|------|
| MIN_DATA | 2.0e5 (25KB) | **6.0e5 (75KB)** | MIN传输4ms→12ms > 10ms ✓ |
| MAX_DATA | 1.0e6 (125KB) | **2.0e6 (250KB)** | 回到参考文献中值 |

**传输时间验证:**
- MIN: 12ms > 10ms ✓
- AVG: 26ms
- MAX: 40ms

---

## 最终配置

```python
# configs/config.py

# 计算量（参考文献2倍）
MIN_COMP = 2.0e7    # 0.02G cycles
MAX_COMP = 2.0e8    # 0.2G cycles

# 数据量（参考文献范围）
MIN_DATA = 6.0e5    # 75KB (满足>10ms断言)
MAX_DATA = 2.0e6    # 250KB (参考文献中值)

# 边数据（参考文献）
MIN_EDGE_DATA = 8.0e5   # 100KB
MAX_EDGE_DATA = 4.0e6   # 500KB

# Deadline（放宽到2-3倍）
DEADLINE_TIGHTENING_MIN = 2.0
DEADLINE_TIGHTENING_MAX = 3.0

# 带宽（保持）
BW_V2I = 50e6  # 50Mbps
```

---

## 性能预估

### 平均DAG (10节点)

```
计算量: 1.1G cycles
数据量: 1.62MB

本地执行:
  平均车辆(2GHz): 0.55s (11步) ✓

RSU执行(单车):
  传输: 0.26s (5步)
  计算: 0.09s (2步)
  总时间: 0.35s (7步)
  收益: 比本地快36% ✓

RSU执行(12车):
  传输: 3.12s (62步) ✓

Deadline:
  平均: 1.65s (33步) ✓
```

**关键指标:**
- ✅ 本地执行可完成（0.55s < 10s）
- ✅ RSU有卸载收益（快36%）
- ✅ 12车共享可完成（3.12s < 10s）
- ✅ Deadline充足（1.65s）
- ✅ 断言通过（MIN传输12ms > 10ms）

---

## 与原计划对比

### 原计划（基于参考文献10倍）
- 计算量: 1e8-1e9 (参考10倍)
- 数据量: 4e5-2e6 (50-250KB)
- 问题: 最坏12s > 10s，必然超时

### 实际采用（参考文献2倍）
- 计算量: 2e7-2e8 (参考2倍)
- 数据量: 6e5-2e6 (75-250KB)
- 优势: 全场景可完成，仍有卸载收益

---

## 预期训练效果

### Episode 1-20
- Task SR: 0% → 20-40%
- Subtask SR: 10% → 60-80%
- Decision: Local 25-35%, RSU 40-50%, V2V 15-25%
- Reward: 信号明显增强

### Episode 20-50
- Task SR: 40% → 60%
- Decision趋于最优分布

### Episode 50-100
- Task SR: 60% → 70%+
- 策略基本收敛

---

## 设计权衡

### 为什么不用参考文献10倍？

**原因:**
1. 本地执行必须可行（作为baseline）
2. 最坏情况不能超时（否则无法学习）
3. 重点是学习"何时卸载"，而非"必须卸载"

### 2倍参考文献是否太简单？

**不简单！因为:**
1. 12车竞争带宽（3.12s vs 0.26s单车）
2. 队列等待（多任务并发）
3. 动态拓扑（车辆移动）
4. 资源分配（CPU/带宽调度）

**关键:** 挑战来自**协同与竞争**，而非单纯的计算量大小

---

## 启动命令

```bash
python train.py
```

**监控重点（前10 episodes）:**
- ✅ 环境初始化成功（无断言错误）
- ✅ Task SR > 0%
- ✅ Subtask SR > 50%
- ✅ Decision不是100%单一

---

**修复完成时间**: 2026-01-05  
**修复版本**: v2 (断言修复版)
